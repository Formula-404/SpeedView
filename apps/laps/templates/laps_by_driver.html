<!-- {% extends "base.html" %}{% load static %}
{% block meta %}<title>Laps – Driver {{ driver_number }}</title>{% endblock %}
{% block content %}
<div class="px-12 py-12 mx-auto">
  <div class="flex items-center justify-between mb-6">
    <div>
      <div class="text-sm text-white/60 mb-3 space-x-2">
        <a class="hover:text-red-400" href="{% url 'main:show_main' %}">Home</a><span>›</span>
        <span class="text-white">Laps</span>
      </div>
      <h1 class="text-3xl font-bold text-white">Driver #{{ driver_number }} Laps</h1>
    </div>
    <form id="filter" class="flex gap-2">
      <input id="session_key" class="w-48 px-3 py-2 rounded bg-[#0D1117] border border-white/10 text-white"
             placeholder="Filter session_key (opsional)">
      <button class="px-4 py-2 bg-gray-700 text-white rounded">Apply</button>
    </form>
  </div>

  <p id="info" class="text-white/60 text-sm mb-3">Loading…</p>
  <div id="list" class="space-y-2"></div>
</div>

<script>
  const driver = {{ driver_number }};
  const info = document.getElementById('info');
  const list = document.getElementById('list');
  const form = document.getElementById('filter');
  const input = document.getElementById('session_key');

  async function load() {
    info.textContent = 'Loading…'; list.innerHTML = '';
    const p = new URLSearchParams();
    if (input.value.trim()) p.set('session_key', input.value.trim());
    const url = `/laps/api/${driver}/?` + p.toString();
    const res = await fetch(url);
    const j = await res.json();
    if (!j.ok) { info.textContent = j.error || 'Failed'; return; }
    info.textContent = `${j.count} laps`;
    for (const r of j.data) {
      const div = document.createElement('div');
      div.className = "p-3 rounded bg-[#0D1117]/80 border border-white/10 text-white/80";
      div.innerHTML = `<b>Lap ${r.lap_number}</b> • s_key ${r.session_key} • ${r.lap_duration ?? '—'}s • i1 ${r.i1_speed ?? '—'} • i2 ${r.i2_speed ?? '—'}`;
      list.appendChild(div);
    }
  }
  form.addEventListener('submit', (e)=>{e.preventDefault(); load();});
  load();
</script>
{% endblock %} -->
