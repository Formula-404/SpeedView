{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="{% static 'image/icon/speedview.png' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    {% block meta %}{% endblock meta %}
    <link rel="stylesheet" href="{% static 'style/global.css' %}" />
</head>
<body class="flex overflow-x-hidden">
    {% include 'sidebar.html' %}

    <div class="w-full min-w-0 overflow-x-hidden md:ml-64">
        <header class="md:hidden sticky top-0 z-30 bg-[#0B0F14] border-b border-gray-800/60">
            <div class="px-4 py-3 flex items-center gap-3">
                <button id="mobile-menu-btn" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-white bg-white/5 border border-white/10">
                    <svg id="mobile-menu-icon" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <a href="{% url 'main:show_main' %}" class="flex items-center">
                    <img class="h-6" src="{% static 'image/icon/speedview-white.png' %}" alt="SpeedView">
                </a>
                <div class="ml-auto"></div>
            </div>
        </header>

        <main class="w-full min-w-0 overflow-x-hidden">
            <div class="w-full min-h-screen">
                {% block content %}{% endblock content %}
            </div>
        </main>
        {% include 'footer.html' %}
    </div>

    <div id="toast-root" class="pointer-events-none fixed top-4 right-4 z-50 flex flex-col gap-3"></div>

    <script>
        (function() {
            const openBtn = document.getElementById("mobile-menu-btn");
            const drawer = document.getElementById("mobile-sidebar");
            const backdrop = document.getElementById("mobile-backdrop");
            const closeBtn = document.getElementById("mobile-close-btn");

            function openDrawer() {
                if (!drawer || !backdrop) return;
                drawer.classList.remove("-translate-x-full");
                drawer.classList.add("translate-x-0");
                backdrop.classList.remove("hidden");
            }

            function closeDrawer() {
                if (!drawer || !backdrop) return;
                drawer.classList.add("-translate-x-full");
                drawer.classList.remove("translate-x-0");
                backdrop.classList.add("hidden");
            }

            if (openBtn) openBtn.addEventListener("click", openDrawer);
            if (closeBtn) closeBtn.addEventListener("click", closeDrawer);
            if (backdrop) backdrop.addEventListener("click", function(e) {
                if (e.target === backdrop) closeDrawer();
            });
            document.addEventListener("keydown", function(e) {
                if (e.key === "Escape") closeDrawer();
            });
        })();
    </script>
    <script>
        (function() {
            const rootId = "toast-root";
            const baseClasses = "pointer-events-auto flex min-w-[240px] max-w-sm items-start gap-3 rounded-xl border px-4 py-3 shadow-lg shadow-black/40 backdrop-blur-sm";
            const variantStyles = {
                success: "border-green-400/60 bg-green-500/10 text-green-200",
                error: "border-red-400/60 bg-red-500/10 text-red-200",
                warning: "border-amber-400/60 bg-amber-500/10 text-amber-100",
                info: "border-white/30 bg-white/10 text-white/90"
            };

            function ensureRoot() {
                let root = document.getElementById(rootId);
                if (!root) {
                    root = document.createElement("div");
                    root.id = rootId;
                    root.className = "pointer-events-none fixed top-4 right-4 z-50 flex flex-col gap-3";
                    document.body.appendChild(root);
                }
                return root;
            }

            function buildIcon(variant) {
                const icon = document.createElement("span");
                icon.className = "mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full border border-current bg-transparent text-xs font-semibold";
                switch (variant) {
                    case "success":
                        icon.textContent = "OK";
                        break;
                    case "error":
                        icon.textContent = "!";
                        break;
                    case "warning":
                        icon.textContent = "!";
                        break;
                    default:
                        icon.textContent = "i";
                        break;
                }
                return icon;
            }

            function removeToast(toast) {
                if (!toast) return;
                toast.classList.add("opacity-0", "translate-y-1");
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.parentElement.removeChild(toast);
                    }
                }, 200);
            }

            window.showToast = function(title, message, variant = "info", timeout = 4000) {
                const root = ensureRoot();
                const normalizedVariant = variantStyles[variant] ? variant : "info";
                const toast = document.createElement("div");
                toast.className = baseClasses + " " + variantStyles[normalizedVariant];
                toast.style.transition = "opacity 0.2s ease, transform 0.2s ease";
                toast.classList.add("opacity-0", "translate-y-2");

                const icon = buildIcon(normalizedVariant);
                const contentWrapper = document.createElement("div");
                contentWrapper.className = "flex-1";

                if (title) {
                    const heading = document.createElement("p");
                    heading.className = "text-sm font-semibold";
                    heading.textContent = title;
                    contentWrapper.appendChild(heading);
                }

                if (message) {
                    const body = document.createElement("p");
                    body.className = "text-xs opacity-80";
                    body.textContent = message;
                    contentWrapper.appendChild(body);
                }

                const closeButton = document.createElement("button");
                closeButton.type = "button";
                closeButton.className = "ml-3 text-xs font-semibold uppercase tracking-wide opacity-70 hover:opacity-100 focus:outline-none";
                closeButton.textContent = "Close";
                closeButton.addEventListener("click", () => removeToast(toast));

                toast.appendChild(icon);
                toast.appendChild(contentWrapper);
                toast.appendChild(closeButton);
                root.appendChild(toast);

                // trigger transition
                requestAnimationFrame(() => {
                    toast.classList.remove("opacity-0", "translate-y-2");
                    toast.classList.add("opacity-100", "translate-y-0");
                });

                const duration = typeof timeout === "number" ? timeout : 4000;
                if (duration > 0) {
                    setTimeout(() => removeToast(toast), duration);
                }
            };
        })();
    </script>
</body>
</html>
